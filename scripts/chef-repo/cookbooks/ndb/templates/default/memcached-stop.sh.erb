#!/bin/sh
wait_pid_removed=10
PID_FILE=<% node[:ndb][:log_dir] %>/memcached_<%= @node_id %>.pid
if [ ! -f $PID_FILE  ] ; then 
    # No pid file, assume  not running
    exit 0
fi

PID=`cat $PID_FILE`
kill -TERM $PID
RES=$?
if [ $RES -ne 0 ] ; then
    timeout=0
    while [ $timeout -lt $wait_pid_removed ] ; do
	sleep 1
	test ! -s $PID_FILE && break
	echo -n "."
	timeout=`expr $timeout + 1`
    done
    if [ $timeout -eq $wait_pid_removed ] ; then
	kill -9 $PID
    fi
else
    exit 0
fi

exit $?
