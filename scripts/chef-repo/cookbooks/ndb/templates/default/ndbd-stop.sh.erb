#!/bin/sh

ID=<%= @node_id %>
PID_FILE=<%= "#{node[:ndb][:log_dir]}/ndb_${ID}.pid" %> 
if [ ! -f $PID_FILE  ] ; then 
    # No pid file, assume  not running
    exit 0
fi

PID=`cat $PID_FILE`
PID=`expr $PID + 1`
echo ""
echo "Killing ndbd with process-id $PID in file $PID_FILE"
echo ""
kill -TERM $PID
wait_pid_removed=10
timeout=0
while [ $timeout -lt $wait_pid_removed ] ; do
    sleep 1
#    test ! -s $PID_FILE && break
    ! kill -0 $PID && break
    echo -n "."
    timeout=`expr $timeout + 1`
done
if [ $timeout -eq $wait_pid_removed ] ; then
  kill -9 $PID
fi
echo ""

